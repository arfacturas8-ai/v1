# RabbitMQ Production Configuration

# Network and Clustering
listeners.tcp.default = 5672
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# SSL Configuration (for production)
listeners.ssl.default = 5671
ssl_options.cacertfile = /etc/rabbitmq/ssl/ca.pem
ssl_options.certfile = /etc/rabbitmq/ssl/server.pem
ssl_options.keyfile = /etc/rabbitmq/ssl/server.key
ssl_options.verify = verify_peer
ssl_options.fail_if_no_peer_cert = false

# Management SSL
management.ssl.port = 15671
management.ssl.cacertfile = /etc/rabbitmq/ssl/ca.pem
management.ssl.certfile = /etc/rabbitmq/ssl/server.pem
management.ssl.keyfile = /etc/rabbitmq/ssl/server.key

# Cluster Configuration
cluster_formation.peer_discovery_backend = classic_config
cluster_formation.classic_config.nodes.1 = cryb-rabbitmq@rabbitmq-1
cluster_formation.classic_config.nodes.2 = cryb-rabbitmq@rabbitmq-2
cluster_formation.classic_config.nodes.3 = cryb-rabbitmq@rabbitmq-3

# High Availability
cluster_partition_handling = autoheal
cluster_keepalive_interval = 10000

# Memory and Disk Management
vm_memory_high_watermark.relative = 0.6
vm_memory_high_watermark_paging_ratio = 0.5
disk_free_limit.relative = 2.0

# Queue Defaults
default_vhost = cryb-prod
default_user = cryb
default_pass = cryb_password
default_permissions.configure = .*
default_permissions.read = .*
default_permissions.write = .*

# Message Store
msg_store_file_size_limit = 16777216
msg_store_credit_disc_bound = {4000, 800}

# Queue Master Locator
queue_master_locator = min-masters

# Consumer Timeout
consumer_timeout = 3600000

# Heartbeat
heartbeat = 600

# Channel Max
channel_max = 2048

# Frame Max (1MB)
frame_max = 1048576

# Connection Max
connection_max = 4096

# Networking
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0

# Resource Limits
process_limit = 1048576

# Logging
log.console = true
log.console.level = info
log.file = /var/log/rabbitmq/rabbitmq.log
log.file.level = info
log.file.rotation.date = $D0
log.file.rotation.size = 10485760

# Management Plugin
management.rates_mode = basic
management.sample_retention_policies.global.minute = 5
management.sample_retention_policies.global.hour = 60
management.sample_retention_policies.global.day = 1200

# Load Definitions on Startup
management.load_definitions = /etc/rabbitmq/definitions.json

# Plugins
plugins.directories = /usr/lib/rabbitmq/plugins
plugins.expand_criteria = all

# Shovel Plugin Configuration (for cross-cluster replication)
shovel.endpoints.source.uris = amqp://guest:guest@localhost:5672/%2f
shovel.endpoints.destination.uris = amqp://guest:guest@remote:5672/%2f

# Federation Plugin Configuration (for distributed messaging)
federation.default_exchange = cryb.federated
federation.default_queue = cryb.federated.queue

# Prometheus Metrics (if enabled)
prometheus.tcp.port = 15692
prometheus.tcp.ip = 0.0.0.0

# Tracing (for debugging)
trace_vhosts.1 = cryb-prod

# Background GC
background_gc_enabled = true
background_gc_target_interval = 60000

# Auth Backends
auth_backends.1 = internal
auth_mechanisms.1 = PLAIN
auth_mechanisms.2 = AMQPLAIN

# Max Connections per User
max_connections_per_user = 500

# Collect Statistics
collect_statistics = coarse
collect_statistics_interval = 5000

# Mirroring
mirroring_sync_batch_size = 4096

# Lazy Queues
queue_lazy = true

# Server Properties
server_properties.product = CRYB RabbitMQ
server_properties.version = 3.12-cryb
server_properties.platform = Erlang/OTP