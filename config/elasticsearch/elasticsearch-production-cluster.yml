# ====================================================
# CRYB Platform - Production Elasticsearch Cluster Configuration
# LinkedIn/Reddit Scale Search Infrastructure
# ====================================================

# Cluster Configuration
cluster.name: cryb-search-cluster
node.name: cryb-search-node-1
path.data: /usr/share/elasticsearch/data
path.logs: /usr/share/elasticsearch/logs

# Network Configuration
network.host: 0.0.0.0
http.port: 9200
transport.port: 9300

# Discovery Configuration (Multi-node cluster ready)
discovery.type: single-node  # Change to zen for multi-node
# discovery.seed_hosts: ["elasticsearch-2:9300", "elasticsearch-3:9300"]
# cluster.initial_master_nodes: ["cryb-search-node-1", "cryb-search-node-2", "cryb-search-node-3"]

# Memory and Performance
bootstrap.memory_lock: true
indices.memory.index_buffer_size: 30%
indices.memory.min_index_buffer_size: 96mb

# Thread Pool Configuration for High Load
thread_pool:
  search:
    size: 13  # (cores * 1.5) + 1
    queue_size: 1000
  index:
    size: 8   # cores
    queue_size: 200
  bulk:
    size: 8   # cores
    queue_size: 200
  get:
    size: 8   # cores
    queue_size: 1000

# Circuit Breaker Configuration
indices.breaker.total.limit: 85%
indices.breaker.request.limit: 40%
indices.breaker.fielddata.limit: 35%

# Index Management
indices.fielddata.cache.size: 30%
indices.queries.cache.size: 10%
indices.requests.cache.size: 2%

# Segment Management
indices.store.throttle.type: none
index.merge.scheduler.max_thread_count: 4

# Shard Configuration Defaults
index.number_of_shards: 5
index.number_of_replicas: 1
index.refresh_interval: 5s

# Logging Configuration
logger.root: INFO
logger.action: DEBUG
logger.com.amazonaws: WARN

# Security (disabled for internal cluster)
xpack.security.enabled: false
xpack.security.enrollment.enabled: false
xpack.security.http.ssl.enabled: false
xpack.security.transport.ssl.enabled: false

# Monitoring
xpack.monitoring.enabled: true
xpack.monitoring.collection.enabled: true

# Machine Learning
xpack.ml.enabled: true
xpack.ml.max_model_memory_limit: 2gb

# Index Lifecycle Management
xpack.ilm.enabled: true

# Watcher (Alerting)
xpack.watcher.enabled: true

# Custom Settings for CRYB Platform
action.destructive_requires_name: true
cluster.routing.allocation.disk.threshold_enabled: true
cluster.routing.allocation.disk.watermark.low: 85%
cluster.routing.allocation.disk.watermark.high: 90%
cluster.routing.allocation.disk.watermark.flood_stage: 95%

# Performance Tuning
search.max_buckets: 65536
indices.query.bool.max_clause_count: 10000

# Bulk Processing
bulk.queue_size: 1000
bulk.flush_threshold: 10mb
bulk.concurrent_requests: 8

# Slow Log Configuration
index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.query.info: 5s
index.search.slowlog.threshold.query.debug: 2s
index.search.slowlog.threshold.query.trace: 500ms

index.search.slowlog.threshold.fetch.warn: 1s
index.search.slowlog.threshold.fetch.info: 800ms
index.search.slowlog.threshold.fetch.debug: 500ms
index.search.slowlog.threshold.fetch.trace: 200ms

index.indexing.slowlog.threshold.index.warn: 10s
index.indexing.slowlog.threshold.index.info: 5s
index.indexing.slowlog.threshold.index.debug: 2s
index.indexing.slowlog.threshold.index.trace: 500ms