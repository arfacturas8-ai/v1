# Fail2Ban filter for CRYB Web application attacks

[Definition]
# Common web attack patterns
failregex = ^<HOST> -.*"(GET|POST|PUT|DELETE).*" 404 .*$
            ^<HOST> -.*"(GET|POST).*(\<|%3C)script.*" [0-9]+ .*$
            ^<HOST> -.*"(GET|POST).*(union|select|insert|delete|drop|update|exec|script).*" [0-9]+ .*$
            ^<HOST> -.*"(GET|POST).*(\.\./|\.\.\\\|%2e%2e%2f|%2e%2e%5c).*" [0-9]+ .*$
            ^<HOST> -.*"(GET|POST).*(cmd=|exec=|command=|shell=).*" [0-9]+ .*$
            ^<HOST> -.*"(GET|POST).*(php://|file://|ftp://|expect://|zip://).*" [0-9]+ .*$

# Brute force patterns
            ^<HOST> -.*"POST /api/auth/login.*" 401 .*$
            ^<HOST> -.*"POST /login.*" 401 .*$
            ^<HOST> -.*"POST /admin/login.*" 401 .*$

# Bot and scanner detection
            ^<HOST> -.*"(GET|POST).*(\.php|\.asp|\.jsp|\.cgi).*" 404 .*$
            ^<HOST> -.*"(GET|POST).*(admin|administrator|wp-admin|phpmyadmin).*" [0-9]+ .*$
            ^<HOST> -.*"(GET|POST).*(\?.*=.*\&.*=.*).*" [0-9]+ .*$

# Rate limiting violations
            ^<HOST> -.*" 429 .*$

# Suspicious user agents
            ^<HOST> -.*".*sqlmap.*" [0-9]+ .*$
            ^<HOST> -.*".*nikto.*" [0-9]+ .*$
            ^<HOST> -.*".*nmap.*" [0-9]+ .*$
            ^<HOST> -.*".*burp.*" [0-9]+ .*$

ignoreregex =

[Init]
maxlines = 10